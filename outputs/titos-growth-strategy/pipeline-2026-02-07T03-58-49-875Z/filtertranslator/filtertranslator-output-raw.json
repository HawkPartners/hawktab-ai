{
  "filters": [
    {
      "ruleId": "rule_s6a_if_s6_yes",
      "questionId": "S6a",
      "action": "filter",
      "filterExpression": "S6 == 1",
      "baseText": "Those who answered Yes to S6 (are of Hispanic or Latino origin)",
      "splits": [],
      "alternatives": [
        {
          "expression": "S6 %in% c(1)",
          "confidence": 0.9,
          "reason": "Equivalent explicit set notation; no change in meaning. Useful if system prefers %in% syntax."
        },
        {
          "expression": "!is.na(S6) & S6 == 1",
          "confidence": 0.7,
          "reason": "More defensive: explicitly excludes NA on S6 before checking equality. Usually unnecessary because pipeline already applies non-NA for the target question, but provided as an alternative if desired."
        }
      ],
      "confidence": 0.95,
      "reasoning": "Datamap contains S6 (categorical_select) with values 1=Yes, 2=No. The rule explicitly requires S6 = 1, so the minimal additional constraint is S6 == 1.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_s10b_show_by_s10a",
      "questionId": "S10b",
      "action": "split",
      "filterExpression": "",
      "baseText": "Show only those S10b subcategory response options that correspond to the respondent's S10a selection",
      "splits": [],
      "alternatives": [
        {
          "expression": "S10a == 1  # then show only S10b response values that belong to S10a category 1",
          "confidence": 0.4,
          "reason": "If S10b response value-to-parent-category mapping were available, each S10b row could be shown when S10a equals the corresponding parent value (example shown for S10a==1). Need mapping of which S10b values belong to each S10a value to generate concrete splits."
        },
        {
          "expression": "S10a %in% c(1,2)  # example: show S10b rows for categories 1 or 2",
          "confidence": 0.25,
          "reason": "Alternate interpretation if S10b options are grouped under multiple S10a parents. This is illustrative only — exact value groups are not in the datamap."
        }
      ],
      "confidence": 0.2,
      "reasoning": "This is a row-level rule that requires mapping each S10b response option (individual subcategory values) to the parent S10a category selection. The datamap contains S10a (values 1-8) and S10b (values include many codes 1-107), but it does NOT include the explicit mapping of which S10b values belong to each S10a category. The Safety Rule in the instructions requires that every split enumerates the target rowVariables and their exact condition variables; because we cannot confidently map all S10b row options to S10a values from the provided datamap, we cannot produce safe per-row split expressions. Leaving splits empty and flagging for human review avoids silently dropping rows or mis-filtering.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_s11b_show_by_s11a",
      "questionId": "S11b",
      "action": "split",
      "filterExpression": "",
      "baseText": "Show only the S11b subcategory responses that correspond to the respondent's S11a selection",
      "splits": [],
      "alternatives": [
        {
          "expression": "S11a == 1 & S11b %in% c(1,2,3,4)  # EXAMPLE",
          "confidence": 0.2,
          "reason": "Concrete mapping of which S11b response codes belong to each S11a category is not present in the datamap. This is an illustrative example only; exact S11b codes per S11a category must be provided to build row-level splits."
        },
        {
          "expression": "S11a == 2 & S11b %in% c(6,7,8,9)  # EXAMPLE",
          "confidence": 0.2,
          "reason": "Alternative illustrative mapping for another S11a category. Do NOT use without verified mapping from instrument codebook."
        }
      ],
      "confidence": 0.2,
      "reasoning": "The rule is a row-level (per-response-option) filter: S11b's available response options should be restricted based on the respondent's S11a selection. The datamap contains S11a (categorical_select 1-8) and S11b (categorical_select 1-107) but does NOT enumerate separate row variables for each S11b option nor document which S11b codes map to each S11a category. Per the safety rules, we cannot invent the mapping or assume naming patterns. Therefore I cannot produce reliable per-row split definitions. Human review is required to supply the explicit mapping of S11b response codes to S11a categories (or the instrument configuration that defines the filtering).",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a5_if_specific_a4_values",
      "questionId": "A5",
      "action": "filter",
      "filterExpression": "A4 %in% c(7, 8, 9, 10, 11, 12, 13)",
      "baseText": "Respondents who selected A4 = 7, 8, 9, 10, 11, 12, or 13 (these specific spirit types)",
      "splits": [],
      "alternatives": [
        {
          "expression": "A4 %in% 7:13",
          "confidence": 0.85,
          "reason": "Compact form equivalent to enumerating 7 through 13; identical for integers."
        },
        {
          "expression": "A4 >= 7 & A4 <= 13",
          "confidence": 0.7,
          "reason": "Range-based expression that captures 7–13. Use with caution if A4 could include non-integer or out-of-order coding (datamap shows integer codes so this is likely safe)."
        }
      ],
      "confidence": 0.95,
      "reasoning": "A4 and A5 both exist in the datamap. A4 is coded 1–15; the rule explicitly lists values 7–13. The primary expression enumerates those values exactly and is the minimal, precise constraint.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a6_on_premise_only",
      "questionId": "A6",
      "action": "filter",
      "filterExpression": "(dLOCATIONr5 == 1 | dLOCATIONr6 == 1 | dLOCATIONr7 == 1 | dLOCATIONr8 == 1 | dLOCATIONr9 == 1 | dLOCATIONr10 == 1 | dLOCATIONr11 == 1 | dLOCATIONr12 == 1 | dLOCATIONr13 == 1 | dLOCATIONr14 == 1)",
      "baseText": "Respondents whose mapped S9 location is an on‑premise location (restaurant/bar/hotel/recreation/concession, etc.)",
      "splits": [],
      "alternatives": [
        {
          "expression": "(dLOCATIONr5 == 1 | dLOCATIONr6 == 1 | dLOCATIONr7 == 1 | dLOCATIONr8 == 1 | dLOCATIONr9 == 1 | dLOCATIONr10 == 1 | dLOCATIONr11 == 1 | dLOCATIONr12 == 1 | dLOCATIONr13 == 1)",
          "confidence": 0.75,
          "reason": "Narrower interpretation: treat indices 5-13 (various restaurant/bar/hotel/recreation venues) as on‑premise and exclude concession stands (dLOCATIONr14)."
        },
        {
          "expression": "(hLOCATIONSr2 == 1 | hLOCATIONSr3 == 1 | hLOCATIONSr4 == 1 | hLOCATIONSr5 == 1 | hLOCATIONSr6 == 1)",
          "confidence": 0.6,
          "reason": "Alternate using the hidden hLOCATIONS flags (RESTAURANT, BAR, HOTEL/MOTEL, RECREATION/ENTERTAINMENT, CONCESSIONAIRE). Less direct because hLOCATIONS fields are admin/hidden and mapping to the specific S9 instance may differ; use only if dLOCATIONr* flags are not appropriate."
        }
      ],
      "confidence": 0.75,
      "reasoning": "Datamap includes dLOCATIONr1..dLOCATIONr16 which are hidden 0/1 flags derived from S9 location items. On‑premise locations correspond to S9 items such as restaurants, bars, hotel/motel, recreation/entertainment and concession stands (dLOCATIONr5..dLOCATIONr14). The primary expression minimally filters A6 to respondents with any of those on‑premise dLOCATION flags = 1. There is some ambiguity about whether concession stands or certain venue types should be included; provided alternatives for a narrower set and for using hLOCATIONS flags.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a10_if_not_alone",
      "questionId": "A10",
      "action": "filter",
      "filterExpression": "A9r1 != 1",
      "baseText": "Those who did NOT indicate \"I was alone\" at A9",
      "splits": [],
      "alternatives": [
        {
          "expression": "A9r1 == 0",
          "confidence": 0.85,
          "reason": "A9r1 is a binary flag (0/1). Using == 0 is an equivalent, slightly stricter explicit check for 'not selected'."
        },
        {
          "expression": "!is.na(A9r1) & A9r1 != 1",
          "confidence": 0.7,
          "reason": "Explicitly excludes cases where A9r1 is missing; typically unnecessary because the pipeline already applies non-NA for the target question, but offered as a conservative alternative."
        }
      ],
      "confidence": 0.95,
      "reasoning": "Datamap contains A9r1: 'I was alone' as a binary_flag (0 = not selected, 1 = selected). The rule asks A10 only when respondent did NOT select 'I was alone', which translates minimally to A9r1 != 1. This avoids over-filtering and uses exact variable names from the datamap.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a13_if_specific_a4_values",
      "questionId": "A13",
      "action": "filter",
      "filterExpression": "A4 %in% c(4, 5, 7, 8, 9, 10, 11, 12, 13)",
      "baseText": "Respondents who selected A4 = 4, 5, 7, 8, 9, 10, 11, 12, or 13 (A4 values where brand is relevant)",
      "splits": [],
      "alternatives": [
        {
          "expression": "A4 == 4 | A4 == 5 | A4 == 7 | A4 == 8 | A4 == 9 | A4 == 10 | A4 == 11 | A4 == 12 | A4 == 13",
          "confidence": 0.85,
          "reason": "Equivalent explicit-equality form; slightly more verbose but exact mapping to listed values."
        },
        {
          "expression": "A4 %in% c(4,5,7:13)",
          "confidence": 0.6,
          "reason": "Shorthand using range for 7:13 is equivalent here but less explicit about omission of 6; included as alternative but could be misread—use only if ranges are acceptable."
        }
      ],
      "confidence": 0.95,
      "reasoning": "A4 exists in the datamap (categorical_select with values 1-15). The rule explicitly lists the allowed A4 values for which A13 should be asked, so the minimal additional constraint is A4 in that set.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a13b_if_a13a_yes",
      "questionId": "A13b",
      "action": "filter",
      "filterExpression": "A13a_1 == 1",
      "baseText": "Those who answered Yes to A13a (had one or more additional drinks) — location 1 version (A13a_1 == 1)",
      "splits": [],
      "alternatives": [
        {
          "expression": "A13a_1 == 1 | A13a_2 == 1",
          "confidence": 0.75,
          "reason": "If A13b can refer to either location variant (A13b for location1 or location2), include respondents who answered Yes to either A13a_1 or A13a_2."
        },
        {
          "expression": "A13a_2 == 1",
          "confidence": 0.6,
          "reason": "If this A13b instance corresponds specifically to the second location version (A13a_2 -> A13b_2), use A13a_2 == 1. Datamap contains both A13a_1 and A13a_2 but the rule text does not specify which location; this is a plausible alternative."
        }
      ],
      "confidence": 0.8,
      "reasoning": "Datamap contains A13a_1 and A13a_2 (both categorical_select 1=Yes,2=No) and A13b row variables exist as A13br1..A13br5 which are the 'other drinks' items tied to the A13b question for location 1. The rule says 'ASK A13b IF A13a=1' — the minimal, direct mapping is A13a_1 == 1. However the survey has two A13a variants (A13a_1 and A13a_2) for different location blocks; if the appliesTo A13b could refer to either, the wider expression (A13a_1 == 1 | A13a_2 == 1) may be appropriate.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A14a",
      "action": "filter",
      "filterExpression": "(hPREMISE1 == 2 | hPREMISE2 == 2)",
      "baseText": "Occasions where the mapped location (LOCATION1 or LOCATION2) is off‑premise",
      "splits": [],
      "alternatives": [
        {
          "expression": "(hPREMISE1 == 1 | hPREMISE2 == 1)",
          "confidence": 0.3,
          "reason": "If the hidden flag uses 1 to indicate off‑premise instead of 2. The datamap only shows hPREMISE1/hPREMISE2 (values 1-2) but does not label which value means off‑premise."
        },
        {
          "expression": "(dLOCATIONr11 == 1 | dLOCATIONr12 == 1 | dLOCATIONr13 == 1 | dLOCATIONr14 == 1 | dLOCATIONr15 == 1 | dLOCATIONr16 == 1)",
          "confidence": 0.25,
          "reason": "Alternative mapping if 'off‑premise' should be inferred from a set of dLOCATIONr* hidden flags (dLOCATIONr# represent specific locations). This is speculative — datamap doesn't document which dLOCATIONr values correspond to 'off‑premise' locations."
        }
      ],
      "confidence": 0.6,
      "reasoning": "Primary uses hPREMISE1/hPREMISE2 which appear to be the hidden premise mapping for LOCATION 1 and LOCATION 2 (variables exist in the datamap). However the datamap does not label which numeric value (1 or 2) corresponds to 'off‑premise', so this mapping is an assumption (we pick 2 as primary). Minimal additional constraint: require location's premise flag indicate off‑premise. Human review recommended.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A14b",
      "action": "filter",
      "filterExpression": "((hPREMISE1 == 2 & A14a_1 == 1) | (hPREMISE2 == 2 & A14a_2 == 1))",
      "baseText": "Occasions off‑premise where respondent was the purchaser (A14a = 1) for the corresponding location",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1) | (hPREMISE2 == 1 & A14a_2 == 1))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 (not 2) indicates off‑premise."
        },
        {
          "expression": "((hPREMISE1 == 2 & A14a == 1) | (hPREMISE2 == 2 & A14a == 1))",
          "confidence": 0.2,
          "reason": "If A14b uses a single A14a variable (no suffix) rather than A14a_1/A14a_2. Datamap shows A14a_1 and A14a_2 exist; still included as a cautious alternative."
        }
      ],
      "confidence": 0.6,
      "reasoning": "A14b should only be shown when the occasion is off‑premise AND the respondent selected 'I went to the store / made the purchase myself' (A14a = 1). Datamap contains A14a_1 and A14a_2 so primary expression pairs the correct A14a instance with the corresponding hPREMISE flag. However, the exact numeric encoding for off‑premise is not labeled; human review needed.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A15",
      "action": "filter",
      "filterExpression": "",
      "baseText": "Occasions off‑premise where respondent purchased the item (A14a = 1) AND the drink type (A4) indicates value 7",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1 & A4 == 7) | (hPREMISE2 == 1 & A14a_2 == 1 & A4_2 == 7))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 represents off‑premise."
        },
        {
          "expression": "((hPREMISE1 == 2 & A14a_1 == 1 & A4 == 7) | (hPREMISE2 == 2 & A14a_2 == 1 & A4 == 7))",
          "confidence": 0.4,
          "reason": "If the A4 variable is not suffixed per location in the data (datamap shows A4 and also references to A4_2 via hidden flags; presence of A4_2 is ambiguous)."
        },
        {
          "expression": "((hPREMISE1 == 2 & A14a_1 == 1 & A4 %in% c(7)) | (hPREMISE2 == 2 & A14a_2 == 1 & A4_2 %in% c(7)))",
          "confidence": 0.35,
          "reason": "Syntactic variant equivalent to == 7; included for clarity."
        }
      ],
      "confidence": 0.55,
      "reasoning": "Rule requires off‑premise + respondent was purchaser + drink type A4 == 7. Datamap contains A14a_1/A14a_2 and A4; A4_2's exact presence is ambiguous. Also the hPREMISE encoding for off‑premise is not labeled. Because of these ambiguities this translation is plausible but requires review. [VALIDATION: Variables A4_2 not found in datamap.]",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A16",
      "action": "filter",
      "filterExpression": "((hPREMISE1 == 2 & A14a_1 == 1) | (hPREMISE2 == 2 & A14a_2 == 1))",
      "baseText": "Occasions off‑premise where respondent was the purchaser (A14a = 1)",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1) | (hPREMISE2 == 1 & A14a_2 == 1))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 indicates off‑premise."
        },
        {
          "expression": "((hPREMISE1 == 2 & A14a == 1) | (hPREMISE2 == 2 & A14a == 1))",
          "confidence": 0.2,
          "reason": "If A16 ties to a non‑suffixed A14a variable rather than A14a_1/A14a_2."
        }
      ],
      "confidence": 0.6,
      "reasoning": "A16-A19 are follow ups only when respondent indicated they purchased the item (A14a = 1) and the occasion is off‑premise. We pair the per‑location A14a_X with the matching hPREMISEX. Datamap ambiguity about which numeric value means off‑premise means human review is needed.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A17",
      "action": "filter",
      "filterExpression": "((hPREMISE1 == 2 & A14a_1 == 1) | (hPREMISE2 == 2 & A14a_2 == 1))",
      "baseText": "Occasions off‑premise where respondent was the purchaser (A14a = 1)",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1) | (hPREMISE2 == 1 & A14a_2 == 1))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 indicates off‑premise."
        }
      ],
      "confidence": 0.6,
      "reasoning": "Same logic as A16: require off‑premise and A14a = 1. Uses per‑location A14a variables from datamap. hPREMISE encoding uncertain.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A18",
      "action": "filter",
      "filterExpression": "((hPREMISE1 == 2 & A14a_1 == 1) | (hPREMISE2 == 2 & A14a_2 == 1))",
      "baseText": "Occasions off‑premise where respondent was the purchaser (A14a = 1)",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1) | (hPREMISE2 == 1 & A14a_2 == 1))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 indicates off‑premise."
        }
      ],
      "confidence": 0.6,
      "reasoning": "A18 is a follow up to A14a for off‑premise purchases. Primary pairs hPREMISEX with A14a_X. Datamap lacks explicit label for hPREMISE values so review required.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a14a_a19_off_premise_only",
      "questionId": "A19",
      "action": "filter",
      "filterExpression": "((hPREMISE1 == 2 & A14a_1 == 1) | (hPREMISE2 == 2 & A14a_2 == 1))",
      "baseText": "Occasions off‑premise where respondent was the purchaser (A14a = 1)",
      "splits": [],
      "alternatives": [
        {
          "expression": "((hPREMISE1 == 1 & A14a_1 == 1) | (hPREMISE2 == 1 & A14a_2 == 1))",
          "confidence": 0.3,
          "reason": "If hPREMISE value 1 indicates off‑premise."
        }
      ],
      "confidence": 0.6,
      "reasoning": "A19 is a follow up to A14a for off‑premise purchases. Uses per‑location A14a variables and hPREMISE flags. Because the datamap does not explicitly label which hPREMISE value means off‑premise and there is some uncertainty about per‑location variable naming for A4/A15, human review is recommended.",
      "humanReviewRequired": true
    },
    {
      "ruleId": "rule_a22_if_any_brand_selected_in_a21",
      "questionId": "A22",
      "action": "filter",
      "filterExpression": "(A21r1 == 1 | A21r2 == 1 | A21r3 == 1 | A21r4 == 1 | A21r5 == 1 | A21r6 == 1)",
      "baseText": "Respondents who selected one or more specific brands in A21 (awareness)",
      "splits": [],
      "alternatives": [
        {
          "expression": "(A21r1 == 1 | A21r2 == 1 | A21r3 == 1 | A21r4 == 1 | A21r5 == 1 | A21r6 == 1 | A21r7 == 1)",
          "confidence": 0.2,
          "reason": "Not recommended: includes A21r7 (None of the above). Shown only for completeness as a potential misinterpretation (would include 'None' which is wrong for this rule)."
        },
        {
          "expression": "(A21r7 != 1)",
          "confidence": 0.75,
          "reason": "If the survey enforces that A21r7 ('None of the above') is mutually exclusive with other brand selections, then 'not None' is a shorter way to express 'selected at least one brand'. Slightly lower confidence because mutual-exclusivity is assumed."
        },
        {
          "expression": "rowSums(cbind(A21r1, A21r2, A21r3, A21r4, A21r5, A21r6)) > 0",
          "confidence": 0.8,
          "reason": "Alternative compact expression that checks any of the brand flags 1-6 is set. Requires use in a data-frame-aware context (rowSums + cbind)."
        }
      ],
      "confidence": 0.95,
      "reasoning": "The datamap contains binary flag variables A21r1..A21r7 for brand awareness. The rule requires that at least one brand was selected in A21. The minimal, explicit translation is to require any of the specific brand flags (A21r1..A21r6) equal 1. A21r7 is 'None of the above' so we exclude it in the primary expression to avoid including respondents who picked 'None'.",
      "humanReviewRequired": false
    },
    {
      "ruleId": "rule_a23_show_brands_selected_in_a21",
      "questionId": "A23",
      "action": "split",
      "filterExpression": "",
      "baseText": "Show only brand rows in A23 that the respondent selected in A21 (awareness flags).",
      "splits": [
        {
          "rowVariables": [
            "A23r1"
          ],
          "filterExpression": "A21r1 == 1",
          "baseText": "Respondents who selected Tito's Handmade Vodka in A21",
          "splitLabel": "Tito's Handmade Vodka"
        },
        {
          "rowVariables": [
            "A23r2"
          ],
          "filterExpression": "A21r2 == 1",
          "baseText": "Respondents who selected Grey Goose in A21",
          "splitLabel": "Grey Goose"
        },
        {
          "rowVariables": [
            "A23r3"
          ],
          "filterExpression": "A21r3 == 1",
          "baseText": "Respondents who selected Ketel One in A21",
          "splitLabel": "Ketel One"
        },
        {
          "rowVariables": [
            "A23r4"
          ],
          "filterExpression": "A21r4 == 1",
          "baseText": "Respondents who selected Maker's Mark in A21",
          "splitLabel": "Maker's Mark"
        },
        {
          "rowVariables": [
            "A23r5"
          ],
          "filterExpression": "A21r5 == 1",
          "baseText": "Respondents who selected Casamigos in A21",
          "splitLabel": "Casamigos"
        },
        {
          "rowVariables": [
            "A23r6"
          ],
          "filterExpression": "A21r6 == 1",
          "baseText": "Respondents who selected Don Julio in A21",
          "splitLabel": "Don Julio"
        }
      ],
      "alternatives": [
        {
          "expression": "A21r1 > 0",
          "confidence": 0.7,
          "reason": "Equivalent for binary_flag variables; >0 is equivalent to == 1 but slightly more permissive if values vary."
        },
        {
          "expression": "A21r1 %in% c(1)",
          "confidence": 0.6,
          "reason": "Alternative syntax using %in%; equivalent but more verbose."
        }
      ],
      "confidence": 0.95,
      "reasoning": "Datamap contains A21r1..A21r6 (binary_flag 0/1) and corresponding A23r1..A23r6 rows. Each A23 row should be shown only when the matching A21 flag == 1. Mapping is direct and unambiguous for rows 1-6.",
      "humanReviewRequired": false
    }
  ]
}