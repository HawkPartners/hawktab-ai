{
  "translation": {
    "filters": [
      {
        "ruleId": "rule_s6a_hispanic_filter",
        "questionId": "S6a",
        "action": "filter",
        "filterExpression": "S6 == 1",
        "baseText": "Respondents who answered Yes to S6 (Are you of Hispanic or Latino origin?)",
        "splits": [],
        "alternatives": [
          {
            "expression": "S6 %in% c(1)",
            "confidence": 0.75,
            "reason": "Functionally identical to S6 == 1; included as an alternative form but not materially different."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap contains S6 (categorical_select) with values 1=Yes, 2=No. The rule explicitly requires S6 = 1, so the minimal additional constraint is S6 == 1.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_s10b_subcategory_filter",
        "questionId": "S10b",
        "action": "split",
        "filterExpression": "",
        "baseText": "Respondents see only S10b subcategory responses that correspond to their S10a selection",
        "splits": [
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 1",
            "baseText": "Those who selected S10a = 1 (A way to feel closer to others and strengthen bonds)",
            "splitLabel": "S10a = 1 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 2",
            "baseText": "Those who selected S10a = 2 (A way to demonstrate that you have good taste)",
            "splitLabel": "S10a = 2 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 3",
            "baseText": "Those who selected S10a = 3 (A chance to try something new)",
            "splitLabel": "S10a = 3 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 4",
            "baseText": "Those who selected S10a = 4 (A way to celebrate or mark a moment / achievement)",
            "splitLabel": "S10a = 4 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 5",
            "baseText": "Those who selected S10a = 5 (A source of indulgence)",
            "splitLabel": "S10a = 5 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 6",
            "baseText": "Those who selected S10a = 6 (An escape from stress or routine)",
            "splitLabel": "S10a = 6 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 7",
            "baseText": "Those who selected S10a = 7 (A way to keep the night going)",
            "splitLabel": "S10a = 7 subcategory"
          },
          {
            "rowVariables": [
              "S10b"
            ],
            "filterExpression": "S10a == 8",
            "baseText": "Those who selected S10a = 8 (A way to honor customs)",
            "splitLabel": "S10a = 8 subcategory"
          }
        ],
        "alternatives": [
          {
            "expression": "S10a %in% c(1,2,3,4,5,6,7,8)",
            "confidence": 0.75,
            "reason": "Less granular alternative: apply a single table-level filter to require S10a to be answered (1-8). This is broader and does not implement per-row subcategory filtering, but ensures S10b only shown when S10a has a valid value."
          }
        ],
        "confidence": 0.9,
        "reasoning": "Datamap contains S10a (categorical 1-8) and S10b (categorical 1-107). The rule is a row-level split: each S10b choice is tied to the S10a category. Minimal per-row constraint is to show S10b rows when S10a equals the corresponding category. Because exact mapping of which S10b response codes map to each S10a category (the specific subcategory values) is not provided in the rule or datamap, we implement splits by S10a value (one split per S10a category) so S10b appears only for respondents with that S10a. This keeps constraints minimal while reflecting the intent. If you need explicit mapping of S10b response codes to S10a categories (to hide only non-matching S10b rows rather than entire S10b question), provide that mapping — otherwise this approach is the safest per the datamap.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_s11b_subcategory_filter",
        "questionId": "S11b",
        "action": "split",
        "filterExpression": "",
        "baseText": "Show only S11b subcategory items that belong to the S11a category the respondent selected",
        "splits": [
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 1",
            "baseText": "Those who selected S11a = 1 (A way to feel closer to others and strengthen bonds)",
            "splitLabel": "S11a = 1"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 2",
            "baseText": "Those who selected S11a = 2 (A way to demonstrate that you have good taste)",
            "splitLabel": "S11a = 2"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 3",
            "baseText": "Those who selected S11a = 3 (A chance to try something new)",
            "splitLabel": "S11a = 3"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 4",
            "baseText": "Those who selected S11a = 4 (A way to celebrate or mark a moment / achievement)",
            "splitLabel": "S11a = 4"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 5",
            "baseText": "Those who selected S11a = 5 (A source of indulgence)",
            "splitLabel": "S11a = 5"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 6",
            "baseText": "Those who selected S11a = 6 (An escape from stress or routine)",
            "splitLabel": "S11a = 6"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 7",
            "baseText": "Those who selected S11a = 7 (A way to keep the night going)",
            "splitLabel": "S11a = 7"
          },
          {
            "rowVariables": [
              "S11b"
            ],
            "filterExpression": "S11a == 8",
            "baseText": "Those who selected S11a = 8 (A way to honor customs)",
            "splitLabel": "S11a = 8"
          }
        ],
        "alternatives": [
          {
            "expression": "S11a %in% c(1,2,3,4,5,6,7,8)",
            "confidence": 0.75,
            "reason": "If system needs a single-table-level constraint to indicate S11b only applies when S11a has any valid selection; but row-level splits are preferred for mapping subcategories."
          }
        ],
        "confidence": 0.85,
        "reasoning": "Datamap contains S11a (categorical_select 1-8) and S11b (categorical_select 1-107). The rule is a row-level subcategory filter: each S11b item is shown only when its parent S11a value was selected. We produce one split per S11a value mapping to S11b rows. This is minimal (adds only the S11a constraint).",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a4_match_prior_beverage_category",
        "questionId": "A4",
        "action": "filter",
        "filterExpression": "(S10c == 1 & A4 == 1) | (S10c == 5 & A4 == 2) | (S10c == 2 & A4 == 3) | (S10c %in% c(2,5) & A4 == 4) | (S10c %in% c(3,4,5) & A4 == 5) | (S10c == 3 & A4 == 6) | (S10c == 4 & A4 %in% c(7,8,9,10,11)) | (S10c %in% c(4,5) & A4 %in% c(12,13,14)) | (S10c == 5 & A4 == 15)",
        "baseText": "Show only A4 options that match the prior beverage category reported in S10c (location 1).",
        "splits": [],
        "alternatives": [
          {
            "expression": "(S11c == 1 & A4 == 1) | (S11c == 5 & A4 == 2) | (S11c == 2 & A4 == 3) | (S11c %in% c(2,5) & A4 == 4) | (S11c %in% c(3,4,5) & A4 == 5) | (S11c == 3 & A4 == 6) | (S11c == 4 & A4 %in% c(7,8,9,10,11)) | (S11c %in% c(4,5) & A4 %in% c(12,13,14)) | (S11c == 5 & A4 == 15)",
            "confidence": 0.85,
            "reason": "If the loop instance corresponds to Location 2, use S11c instead of S10c. The rule references S10c / S11c depending on loop — include S11c when appropriate."
          },
          {
            "expression": "((S10c == 1 | S11c == 1) & A4 == 1) | ((S10c == 5 | S11c == 5) & A4 == 2) | ((S10c == 2 | S11c == 2) & A4 == 3) | ((S10c %in% c(2,5) | S11c %in% c(2,5)) & A4 == 4) | ((S10c %in% c(3,4,5) | S11c %in% c(3,4,5)) & A4 == 5) | ((S10c == 3 | S11c == 3) & A4 == 6) | ((S10c == 4 | S11c == 4) & A4 %in% c(7,8,9,10,11)) | ((S10c %in% c(4,5) | S11c %in% c(4,5)) & A4 %in% c(12,13,14)) | ((S10c == 5 | S11c == 5) & A4 == 15)",
            "confidence": 0.6,
            "reason": "Less minimal: allows either S10c or S11c to validate A4 (could be used if loop mapping to location isn't tracked here). This is broader and risks showing options when the wrong location's S#c matches, so use only if loop context unknown."
          }
        ],
        "confidence": 0.85,
        "reasoning": "Datamap contains A4 (values 1-15) and both S10c and S11c (each categorical_select with values 1-5). The rule maps each A4 option to specific S10c/S11c values per the rule text. Primary expression uses S10c (location 1) as the minimal mapping per loop; if the loop instance is for location 2, S11c should be used instead (provided in alternatives).",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a5_spirit_form_filter",
        "questionId": "A5",
        "action": "filter",
        "filterExpression": "A4 %in% c(7, 8, 9, 10, 11, 12, 13)",
        "baseText": "Those who said the drink was a spirit/liquor (A4 = 7,8,9,10,11,12,13)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A4 >= 7 & A4 <= 13",
            "confidence": 0.75,
            "reason": "Equivalent numeric range if A4 is strictly integer and contiguous; slightly less explicit about exact allowed values but simpler."
          },
          {
            "expression": "A4 %in% c(7:13)",
            "confidence": 0.7,
            "reason": "Uses R sequence shorthand; same set as primary but some teams prefer explicit vector listing."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap contains A4 (categorical_select) with values including 7=Vodka, 8=Whiskey/Bourbon, 9=Tequila/Mezcal, 10=Rum, 11=Gin, 12=Cordial, 13=Cognac (and others). The rule explicitly references A4 values 7-13; primary expression uses %in% to exactly match those values. This is a minimal additional constraint on top of banner cut + non-NA for A5.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a6_on_premise_only",
        "questionId": "A6",
        "action": "filter",
        "filterExpression": "hPREMISE1 == 1 | hPREMISE2 == 1",
        "baseText": "Those whose selected location for the occasion is on‑premise",
        "splits": [],
        "alternatives": [
          {
            "expression": "hPREMISE1 == 1",
            "confidence": 0.75,
            "reason": "If A6 only relates to LOCATION1’s occasion (loop 1). Use when asking about the first location only."
          },
          {
            "expression": "hPREMISE2 == 1",
            "confidence": 0.75,
            "reason": "If A6 only relates to LOCATION2’s occasion (loop 2). Use when asking about the second location only."
          }
        ],
        "confidence": 0.85,
        "reasoning": "Datamap includes hPREMISE1 and hPREMISE2 described as Hidden: hPREMISE1/hPREMISE2 which map to on‑premise (values 1-2). The rule refers to asking A6 when the loop location is on‑premise; minimal additional constraint is that the current loop (either LOCATION1 or LOCATION2) is on‑premise. Using (hPREMISE1 == 1 | hPREMISE2 == 1) covers both loops. Alternatives restrict to a single loop if the table is tied to a specific loop.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a10_not_alone_only",
        "questionId": "A10",
        "action": "filter",
        "filterExpression": "A9r1 != 1",
        "baseText": "Those who did NOT indicate 'I was alone' at A9",
        "splits": [],
        "alternatives": [
          {
            "expression": "A9r1 == 0",
            "confidence": 0.8,
            "reason": "A9r1 is a binary_flag (0/1). Interpreting 'not alone' as the 'I was alone' flag being unset (0) is equivalent to A9r1 != 1 for valid values; use this if dataset encodes presence as 1 and absence as 0."
          },
          {
            "expression": "(A9r1 != 1) & !is.na(A9r1)",
            "confidence": 0.7,
            "reason": "Stricter: ensure A9r1 is not NA in addition to not being 1. The pipeline already applies non-NA for the target question (A10), but this adds NA-check on the condition variable."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap shows A9r1 is the 'I was alone' binary_flag with allowed values 0 or 1. The minimal translation for 'did NOT indicate they were alone' is A9r1 != 1. Alternative A9r1 == 0 is equivalent given the binary coding.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a13_brand_question_filter",
        "questionId": "A13",
        "action": "filter",
        "filterExpression": "A4 %in% c(4, 5, 7, 8, 9, 10, 11, 12, 13)",
        "baseText": "Those who selected A4 = one of 4,5,7,8,9,10,11,12,13 (asked only for these drink types)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A4 %in% c(4,5,7:13)",
            "confidence": 0.8,
            "reason": "Shorthand using sequence 7:13 is equivalent; some codebases prefer explicit listing. Same logical filter."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap contains A4 (categorical_select with allowed values including 4,5,7-13). The rule explicitly lists those values; minimal additional constraint is A4 in that set.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a13b_followup_if_multiple_drinks",
        "questionId": "A13b",
        "action": "filter",
        "filterExpression": "A13a_1 == 1",
        "baseText": "Those who said Yes to A13a (had other drinks in addition to the main drink)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A13a_2 == 1",
            "confidence": 0.4,
            "reason": "If the follow-up could apply to A13b for the second drink block (A13a_2) instead of A13a_1. Datamap shows A13a_1 and A13a_2; the rule references A13a generically — primary mapping chosen as A13a_1 because A13b variables for the first block (A13b_1) exist in the datamap."
          }
        ],
        "confidence": 0.9,
        "reasoning": "Datamap contains A13a_1 (In addition to [pipe: A4_1], did you have any other drinks ... ) and corresponding A13br* (A13br1..A13br5) which are the A13b items for the first drink. The rule text references A13a=1; the minimal, direct translation is A13a_1 == 1.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a14a_off_premise_only",
        "questionId": "A14a",
        "action": "filter",
        "filterExpression": "(hPREMISE1 == 1 | hPREMISE2 == 1)",
        "baseText": "Those whose mapped location is off-premise",
        "splits": [],
        "alternatives": [
          {
            "expression": "hPREMISE1 == 1",
            "confidence": 0.75,
            "reason": "If A14a refers specifically to LOCATION1 only (use hPREMISE1 to indicate off-premise for location 1)."
          },
          {
            "expression": "hPREMISE2 == 1",
            "confidence": 0.75,
            "reason": "If A14a refers specifically to LOCATION2 only (use hPREMISE2 to indicate off-premise for location 2)."
          },
          {
            "expression": "(hPREMISE1 == 1 | hPREMISE2 == 1) & (hLOCATION1 == 1 | hLOCATION2 == 1)",
            "confidence": 0.5,
            "reason": "Alternative that also ensures respondent was assigned to one of the two locations (less minimal; include only if needed)."
          }
        ],
        "confidence": 0.85,
        "reasoning": "Datamap contains hPREMISE1 and hPREMISE2 (Hidden: hPREMISE1/2). The rule requires A14a only when the loop location is off-premise. The minimal, defensible translation is that off-premise is indicated by hPREMISE1==1 or hPREMISE2==1. If A14a is asked per-location, use the per-location variant (hPREMISE1 or hPREMISE2).",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a14b_if_purchased_self",
        "questionId": "A14b",
        "action": "filter",
        "filterExpression": "A14a_1 == 1 | A14a_2 == 1",
        "baseText": "Those who indicated they purchased the drink themselves (A14a = 1) for either Location 1 or Location 2",
        "splits": [],
        "alternatives": [
          {
            "expression": "A14a_1 == 1",
            "confidence": 0.8,
            "reason": "If this A14b refers only to the first purchase question (A14b_1 / A14b_2 mapping ambiguous). Use A14a_1 when A14b refers to the Location1 purchase only."
          },
          {
            "expression": "A14a_2 == 1",
            "confidence": 0.8,
            "reason": "If this A14b refers only to the second purchase question (A14b_2). Use A14a_2 when A14b refers to the Location2 purchase only."
          },
          {
            "expression": "(A14a_1 == 1 & hA14b_1 == 1) | (A14a_2 == 1 & hA14b_2 == 1)",
            "confidence": 0.55,
            "reason": "Alternative tying A14a to hidden hA14b indicators (hA14b_1 / hA14b_2) if those determine which A14b instance is shown; this is speculative because mapping between A14b and the specific location instance in the datamap is not explicit."
          }
        ],
        "confidence": 0.85,
        "reasoning": "Datamap contains A14a_1 and A14a_2 (both 1=Yes meaning respondent purchased it themselves) and A14b appears as A14b_1 and A14b_2 in the datamap. The rule says show A14b when A14a = 1. Minimal defensible translation is to include respondents who indicated A14a = 1 for either location (A14a_1 or A14a_2).",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a15_vodka_size_if_vodka_and_purchased",
        "questionId": "A15",
        "action": "filter",
        "filterExpression": "A4 == 7 & A14a_1 == 1",
        "baseText": "Asked only when respondent chose Vodka at A4 and indicated they purchased it themself (A14a = 1).",
        "splits": [],
        "alternatives": [
          {
            "expression": "A4 == 7 & A14a_2 == 1",
            "confidence": 0.55,
            "reason": "If the rule could refer to the second location's purchase question (A14a_2) instead of A14a_1. Datamap contains A14a_1 and A14a_2; original rule mentions 'A14a' without specifying location. If the survey context is location 1, A14a_1 is correct; if location 2, use A14a_2."
          },
          {
            "expression": "A4 == 7 & (A14a_1 == 1 | A14a_2 == 1)",
            "confidence": 0.45,
            "reason": "Broader interpretation: include respondents who purchased themself at either location. This is less minimal and may over-include; include only if intended."
          }
        ],
        "confidence": 0.9,
        "reasoning": "Datamap contains A4 (question about drink type) with value 7 = Vodka and contains A14a_1 (role in purchase for location 1) with values 1-4. The rule text references A4 and A14a; since A15 corresponds to the purchase bottle size and A15 in datamap exists, the minimal, high-confidence translation is to require A4 == 7 and A14a_1 == 1 (purchased it themself). If the rule was meant for location 2, use A14a_2 instead — provided as an alternative.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a16_to_a19_if_purchased",
        "questionId": "A16",
        "action": "filter",
        "filterExpression": "A14a_1 == 1 | A14a_2 == 1",
        "baseText": "Those who purchased the drink themselves (A14a = 1)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A14a_1 == 1",
            "confidence": 0.85,
            "reason": "If A16 refers to the first drink block (A4_1) only, use A14a_1. Datamap contains A14a_1 and A14a_2 (for two drink blocks)."
          },
          {
            "expression": "A14a_2 == 1",
            "confidence": 0.85,
            "reason": "If A16 refers to the second drink block (A4_2) only, use A14a_2."
          }
        ],
        "confidence": 0.8,
        "reasoning": "Datamap includes A14a_1 and A14a_2 (responses for 'role in original purchase' for each drink). The rule says A14a = 1 (respondent purchased the alcohol themselves). Minimal safe translation is to require the matching A14a variable for the relevant drink. Because the rule applies to multiple questions (A16–A19) and the survey has two parallel blocks (questions suffixed _1 and _2), the minimal combined constraint that covers either block is (A14a_1 == 1 | A14a_2 == 1). If these target questions are specific to a single block in processing, use the corresponding A14a_1 or A14a_2 alternative.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a16_to_a19_if_purchased",
        "questionId": "A17",
        "action": "filter",
        "filterExpression": "A14a_1 == 1 | A14a_2 == 1",
        "baseText": "Those who purchased the drink themselves (A14a = 1)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A14a_1 == 1",
            "confidence": 0.85,
            "reason": "If A17 corresponds to the first drink block (A4_1), require A14a_1 == 1."
          },
          {
            "expression": "A14a_2 == 1",
            "confidence": 0.85,
            "reason": "If A17 corresponds to the second drink block (A4_2), require A14a_2 == 1."
          }
        ],
        "confidence": 0.8,
        "reasoning": "Same mapping rationale as for A16. Datamap contains A14a_1 and A14a_2; the rule's intent is respondents who purchased the drink themselves.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a16_to_a19_if_purchased",
        "questionId": "A18",
        "action": "filter",
        "filterExpression": "A14a_1 == 1 | A14a_2 == 1",
        "baseText": "Those who purchased the drink themselves (A14a = 1)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A14a_1 == 1",
            "confidence": 0.85,
            "reason": "If A18 is for the first drink block, require A14a_1 == 1."
          },
          {
            "expression": "A14a_2 == 1",
            "confidence": 0.85,
            "reason": "If A18 is for the second drink block, require A14a_2 == 1."
          }
        ],
        "confidence": 0.8,
        "reasoning": "Same as above — minimal constraint is that the respondent's role in the purchase was 'I went to the store/made the purchase myself' (value 1) for the matching block.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a16_to_a19_if_purchased",
        "questionId": "A19",
        "action": "filter",
        "filterExpression": "A14a_1 == 1 | A14a_2 == 1",
        "baseText": "Those who purchased the drink themselves (A14a = 1)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A14a_1 == 1",
            "confidence": 0.85,
            "reason": "If A19 corresponds to the first drink block, use A14a_1 == 1."
          },
          {
            "expression": "A14a_2 == 1",
            "confidence": 0.85,
            "reason": "If A19 corresponds to the second drink block, use A14a_2 == 1."
          }
        ],
        "confidence": 0.8,
        "reasoning": "Datamap has separate A14a variables per drink (A14a_1, A14a_2). The rule's plain text references A14a = 1. Applying the minimal additional constraint requires that the respondent selected 'I went to the store/made the purchase myself' for the corresponding block. Using the OR across both blocks is the minimal safe expression when the block mapping is not explicitly provided.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a13b_if_a13a_yes",
        "questionId": "A13b",
        "action": "filter",
        "filterExpression": "A13a_1 == 1 | A13a_2 == 1",
        "baseText": "Those who said they had other drinks in addition to the main drink (A13a = 1)",
        "splits": [],
        "alternatives": [
          {
            "expression": "A13a_1 == 1",
            "confidence": 0.85,
            "reason": "If A13b refers specifically to the A13b set tied to A13a_1 (the first location/drink). Use this when reporting only A13b questions for the first drink."
          },
          {
            "expression": "A13a_2 == 1",
            "confidence": 0.85,
            "reason": "If A13b refers specifically to the A13b set tied to A13a_2 (the second location/drink). Use this when reporting only A13b questions for the second drink."
          },
          {
            "expression": "A13a_1 %in% c(1) | A13a_2 %in% c(1)",
            "confidence": 0.8,
            "reason": "Equivalent minimal expression using %in% for clarity; same logic as primary."
          }
        ],
        "confidence": 0.8,
        "reasoning": "Datamap contains A13a_1 and A13a_2 (categorical_select 1=Yes, 2=No). A13b likely follows when either A13a_1 or A13a_2 indicates 'Yes'. To avoid over-filtering, include respondents who answered Yes for either location (A13a_1 or A13a_2). If A13b is only for one specific A13a (e.g., the first), use the corresponding alternative and set human review if needed.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a22_if_any_brand_selected",
        "questionId": "A22",
        "action": "filter",
        "filterExpression": "(A21r1 == 1 | A21r2 == 1 | A21r3 == 1 | A21r4 == 1 | A21r5 == 1 | A21r6 == 1 | A21r7 == 1)",
        "baseText": "Respondents who selected one or more brands in A21 (brand awareness)",
        "splits": [],
        "alternatives": [
          {
            "expression": "rowSums(cbind(A21r1, A21r2, A21r3, A21r4, A21r5, A21r6, A21r7), na.rm = TRUE) > 0",
            "confidence": 0.85,
            "reason": "Equivalent check using a row-sum across the A21 binary flags; minimal and concise but uses rowSums which is fine in R data pipelines."
          },
          {
            "expression": "(A21r1 %in% c(1) | A21r2 %in% c(1) | A21r3 %in% c(1) | A21r4 %in% c(1) | A21r5 %in% c(1) | A21r6 %in% c(1) | A21r7 %in% c(1))",
            "confidence": 0.8,
            "reason": "Same as primary but written using %in% for explicit value matching; slightly more verbose without changing logic."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap contains A21r1..A21r7 as binary_flag variables (0/1). The rule requires 'any brand selected in A21' — checking that at least one of these equals 1 is the minimal additional constraint beyond the default base. All referenced variables exist in the datamap.",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a22_row_level_show_brands",
        "questionId": "A22",
        "action": "split",
        "filterExpression": "",
        "baseText": "Show each brand row in A22 only for respondents who selected that brand in A21",
        "splits": [
          {
            "rowVariables": [
              "A22r1c1"
            ],
            "filterExpression": "A21r1 == 1",
            "baseText": "Tito's Handmade Vodka — respondents who indicated awareness (A21r1 = 1)",
            "splitLabel": "Tito's Handmade Vodka"
          },
          {
            "rowVariables": [
              "A22r1c2"
            ],
            "filterExpression": "A21r2 == 1",
            "baseText": "Grey Goose — respondents who indicated awareness (A21r2 = 1)",
            "splitLabel": "Grey Goose"
          },
          {
            "rowVariables": [
              "A22r1c3"
            ],
            "filterExpression": "A21r3 == 1",
            "baseText": "Ketel One — respondents who indicated awareness (A21r3 = 1)",
            "splitLabel": "Ketel One"
          },
          {
            "rowVariables": [
              "A22r1c4"
            ],
            "filterExpression": "A21r4 == 1",
            "baseText": "Maker's Mark — respondents who indicated awareness (A21r4 = 1)",
            "splitLabel": "Maker's Mark"
          },
          {
            "rowVariables": [
              "A22r1c5"
            ],
            "filterExpression": "A21r5 == 1",
            "baseText": "Casamigos — respondents who indicated awareness (A21r5 = 1)",
            "splitLabel": "Casamigos"
          },
          {
            "rowVariables": [
              "A22r1c6"
            ],
            "filterExpression": "A21r6 == 1",
            "baseText": "Don Julio — respondents who indicated awareness (A21r6 = 1)",
            "splitLabel": "Don Julio"
          },
          {
            "rowVariables": [
              "A22r1c7"
            ],
            "filterExpression": "A21r7 == 1",
            "baseText": "None of the above — respondents who selected 'None of the above' at A21 (A21r7 = 1)",
            "splitLabel": "None of the above"
          }
        ],
        "alternatives": [
          {
            "expression": "A21r1 == 1",
            "confidence": 0.95,
            "reason": "Primary interpretation: each A22 brand row maps to the corresponding A21 binary_flag (0/1). Datamap contains A21r1..A21r7 and A22r1c1..A22r10c7 so mapping is direct."
          },
          {
            "expression": "A21r1 %in% c(1)",
            "confidence": 0.6,
            "reason": "Equivalent expression for single-value match; included as syntactic alternative though not materially different."
          }
        ],
        "confidence": 0.9,
        "reasoning": "Datamap contains binary_flag variables A21r1 through A21r7 representing which brands respondents are aware of, and A22 has matching brand columns (A22r* c*). The rule requires per-row show-if-selected logic, so each A22 brand row is shown when the corresponding A21r# == 1. Mapping covers all listed brand rows for A22 (at least the columns for brand rows exist in the datamap). This is the minimal additional constraint on top of the default base (banner cut + non-NA for A22).",
        "humanReviewRequired": false
      },
      {
        "ruleId": "rule_a23_show_only_brands_selected",
        "questionId": "A23",
        "action": "split",
        "filterExpression": "",
        "baseText": "Show each brand row in A23 only for respondents who selected that brand in A21 (aware of the brand)",
        "splits": [
          {
            "rowVariables": [
              "A23r1"
            ],
            "filterExpression": "A21r1 == 1",
            "baseText": "Respondents aware of Tito's Handmade Vodka (A21r1 == 1)",
            "splitLabel": "Tito's Handmade Vodka"
          },
          {
            "rowVariables": [
              "A23r2"
            ],
            "filterExpression": "A21r2 == 1",
            "baseText": "Respondents aware of Grey Goose (A21r2 == 1)",
            "splitLabel": "Grey Goose"
          },
          {
            "rowVariables": [
              "A23r3"
            ],
            "filterExpression": "A21r3 == 1",
            "baseText": "Respondents aware of Ketel One (A21r3 == 1)",
            "splitLabel": "Ketel One"
          },
          {
            "rowVariables": [
              "A23r4"
            ],
            "filterExpression": "A21r4 == 1",
            "baseText": "Respondents aware of Maker's Mark (A21r4 == 1)",
            "splitLabel": "Maker's Mark"
          },
          {
            "rowVariables": [
              "A23r5"
            ],
            "filterExpression": "A21r5 == 1",
            "baseText": "Respondents aware of Casamigos (A21r5 == 1)",
            "splitLabel": "Casamigos"
          },
          {
            "rowVariables": [
              "A23r6"
            ],
            "filterExpression": "A21r6 == 1",
            "baseText": "Respondents aware of Don Julio (A21r6 == 1)",
            "splitLabel": "Don Julio"
          }
        ],
        "alternatives": [
          {
            "expression": "A21r1 %in% c(1)  # equivalent to A21r1 == 1",
            "confidence": 0.6,
            "reason": "Same semantic check but using %in% form; not necessary here but functionally equivalent."
          }
        ],
        "confidence": 0.95,
        "reasoning": "Datamap contains A23r1..A23r6 (A23 rows) and corresponding A21r1..A21r6 (brand awareness) as binary_flag (0/1). The rule maps each A23 row to its matching A21 binary flag; showing row when A21rX == 1 is minimal and correct.",
        "humanReviewRequired": false
      }
    ]
  },
  "metadata": {
    "filtersTranslated": 20,
    "highConfidenceCount": 20,
    "reviewRequiredCount": 0,
    "durationMs": 218598
  },
  "processingInfo": {
    "timestamp": "2026-02-07T05:33:56.623Z",
    "aiProvider": "azure-openai",
    "model": "azure/gpt-5-mini",
    "reasoningEffort": "minimal"
  }
}